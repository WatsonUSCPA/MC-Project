<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MC Square - 管理者画面</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Kaku Gothic Pro', 'ヒラギノ角ゴ Pro W3', Meiryo, sans-serif;
            line-height: 1.6;
            color: #4a4a4a;
            background: #f5f5f5;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: #fff;
            padding: 1rem 0;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ff6b6b;
        }

        .nav-buttons {
            display: flex;
            gap: 1rem;
        }

        .nav-button {
            display: inline-block;
            background: #ff6b6b;
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .nav-button:hover {
            background: #ff5252;
        }

        .admin-content {
            background: #fff;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .admin-section {
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #ff6b6b;
        }

        .influencer-list {
            display: grid;
            gap: 1rem;
        }

        .influencer-card {
            background: #f9f9f9;
            padding: 1rem;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .influencer-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .influencer-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 5px;
        }

        .influencer-details {
            flex: 1;
        }

        .influencer-name {
            font-weight: bold;
            color: #333;
        }

        .influencer-url {
            color: #666;
            font-size: 0.9rem;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .action-button {
            padding: 0.3rem 0.6rem;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .edit-button {
            background: #4CAF50;
            color: white;
        }

        .delete-button {
            background: #f44336;
            color: white;
        }

        .add-button {
            background: #2196F3;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 1rem;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
        }

        .modal-content {
            background: #fff;
            width: 90%;
            max-width: 600px;
            margin: 50px auto;
            padding: 2rem;
            border-radius: 10px;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #333;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .form-group textarea {
            height: 100px;
            resize: vertical;
        }

        .url-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1rem;
        }

        .save-button {
            background: #4CAF50;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .cancel-button {
            background: #f44336;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .form-group input[type="file"] {
            display: none;
        }

        .image-upload-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .image-preview {
            width: 200px;
            height: 200px;
            border: 2px dashed #ddd;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: #f9f9f9;
        }

        .image-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .upload-button {
            background: #2196F3;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .upload-button:hover {
            background: #1976D2;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="admin-header">
                <div class="logo">MC Square 管理者画面</div>
                <div class="nav-buttons">
                    <a href="index.html" class="nav-button">🏠 サイトに戻る</a>
                    <a href="#" class="nav-button" id="logoutButton">🚪 ログアウト</a>
                </div>
            </div>
        </header>

        <div class="admin-content">
            <div class="admin-section">
                <h2 class="section-title">インフルエンサー管理</h2>
                <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                    <button class="add-button" id="addInfluencerButton">➕ 新規インフルエンサー追加</button>
                    <button class="add-button" style="background: #4CAF50;" onclick="exportData()">📥 データをエクスポート</button>
                    <button class="add-button" style="background: #FF9800;" onclick="importData()">📤 データをインポート</button>
                </div>
                <div class="influencer-list" id="influencerList">
                    <!-- インフルエンサーリストはJavaScriptで動的に生成 -->
                </div>
            </div>
        </div>
    </div>

    <!-- インフルエンサー追加/編集モーダル -->
    <div class="modal" id="influencerModal">
        <div class="modal-content">
            <h2 class="section-title" id="modalTitle">インフルエンサー追加</h2>
            <form id="influencerForm">
                <div class="form-group">
                    <label for="influencerName">名前</label>
                    <input type="text" id="influencerName" required>
                </div>
                <div class="form-group">
                    <label for="influencerDescription">説明</label>
                    <textarea id="influencerDescription" required></textarea>
                </div>
                <div class="form-group">
                    <label for="influencerPrice">月額料金</label>
                    <input type="number" id="influencerPrice" required>
                </div>
                <div class="form-group">
                    <label for="influencerFeatures">特徴（カンマ区切り）</label>
                    <input type="text" id="influencerFeatures" required>
                </div>
                <div class="form-group url-group">
                    <div>
                        <label for="influencerUrl">申し込みURL</label>
                        <input type="url" id="influencerUrl" required>
                    </div>
                    <div>
                        <label for="influencerProfileUrl">インフルエンサーURL</label>
                        <input type="url" id="influencerProfileUrl" required>
                    </div>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="cancel-button" id="cancelButton">キャンセル</button>
                    <button type="submit" class="save-button">保存</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // インフルエンサーデータの管理
        let influencers = [];

        // データの読み込み
        function loadInfluencerData() {
            const savedData = localStorage.getItem('influencers');
            if (savedData) {
                influencers = JSON.parse(savedData);
            } else {
                // 初期データを設定
                influencers = [
                    {
                        id: 1,
                        name: "Ami-Chiku labo",
                        image: "Image/Ami-Chiku labo.png",
                        description: "手作りの楽しさを伝える人気クリエイター。オリジナルデザインのキットで、あなたの手作りライフを彩ります。",
                        price: 1650,
                        features: ["オリジナルデザインキット", "詳細な作り方ガイド", "動画レッスン", "コミュニティへの参加"],
                        url: "https://linktr.ee/mcsquareofficial",
                        profileUrl: "https://www.instagram.com/ami_chiku_labo/"
                    },
                    {
                        id: 2,
                        name: "p_quiltKon",
                        image: "Image/p_quiltKon.png",
                        description: "パッチワークの魅力を発信する人気インスタグラマー。季節感あふれる作品をお届けします。",
                        price: 1870,
                        features: ["季節限定デザイン", "プロのテクニック解説", "オンラインサポート", "限定ワークショップ"],
                        url: "https://linktr.ee/mcsquareofficial",
                        profileUrl: "https://www.instagram.com/p_quiltkon/"
                    },
                    {
                        id: 3,
                        name: "Jaime（ハイメ）の刺しゅう便",
                        image: "Image/Jaime.png",
                        description: "繊細な刺しゅう作品で人気のクリエイター。心癒される作品をお届けします。",
                        price: 2000,
                        features: ["オリジナル刺しゅうキット", "動画レッスン", "材料セット", "コミュニティ参加"],
                        url: "https://linktr.ee/mcsquareofficial",
                        profileUrl: "https://www.instagram.com/jaime_embroidery/"
                    }
                ];
                saveInfluencerData(); // 初期データを保存
            }
            renderInfluencerList();
        }

        // データの保存
        function saveInfluencerData() {
            const formData = new FormData(document.getElementById('influencerForm'));
            const data = {
                name: formData.get('name'),
                image: formData.get('image'),
                description: formData.get('description'),
                price: formData.get('price'),
                features: formData.get('features').split('\n').filter(f => f.trim())
            };

            // ローカルストレージに保存
            const influencers = JSON.parse(localStorage.getItem('influencers') || '[]');
            const index = parseInt(formData.get('index'));
            
            if (index >= 0) {
                influencers[index] = data;
            } else {
                influencers.push(data);
            }
            
            localStorage.setItem('influencers', JSON.stringify(influencers));
            loadInfluencerData();
            document.getElementById('influencerForm').reset();
            document.getElementById('formIndex').value = '';

            // 保存時に自動でJSONファイルを生成してdataフォルダに保存
            const jsonData = JSON.stringify(influencers, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            
            // File System Access APIを使用してファイルを保存
            if ('showSaveFilePicker' in window) {
                window.showSaveFilePicker({
                    suggestedName: 'influencers.json',
                    types: [{
                        description: 'JSON Files',
                        accept: { 'application/json': ['.json'] }
                    }]
                }).then(fileHandle => {
                    return fileHandle.createWritable();
                }).then(writable => {
                    return writable.write(blob);
                }).then(() => {
                    alert('データを保存し、JSONファイルを更新しました。');
                }).catch(err => {
                    console.error('ファイルの保存に失敗しました:', err);
                    alert('ファイルの保存に失敗しました。手動で保存してください。');
                });
            } else {
                // File System Access APIが使用できない場合は、従来のダウンロード方式を使用
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'influencers.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                alert('データを保存しました。JSONファイルをdataフォルダに配置してください。');
            }
        }

        // JSONファイルをダウンロード
        function downloadJSON() {
            const influencers = JSON.parse(localStorage.getItem('influencers') || '[]');
            const blob = new Blob([JSON.stringify(influencers, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'influencers.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // JSONファイルをアップロード
        function uploadJSON(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        localStorage.setItem('influencers', JSON.stringify(data));
                        loadInfluencerData();
                        alert('データを読み込みました');
                    } catch (error) {
                        alert('無効なJSONファイルです');
                    }
                };
                reader.readAsText(file);
            }
        }

        // DOM要素の取得
        const influencerList = document.getElementById('influencerList');
        const addInfluencerButton = document.getElementById('addInfluencerButton');
        const influencerModal = document.getElementById('influencerModal');
        const influencerForm = document.getElementById('influencerForm');
        const cancelButton = document.getElementById('cancelButton');
        const modalTitle = document.getElementById('modalTitle');

        // インフルエンサーリストの表示
        function renderInfluencerList() {
            influencerList.innerHTML = influencers.map(influencer => `
                <div class="influencer-card">
                    <div class="influencer-info">
                        <img src="${influencer.image}" alt="${influencer.name}" class="influencer-image">
                        <div class="influencer-details">
                            <div class="influencer-name">${influencer.name}</div>
                            <div class="influencer-url">申し込み: ${influencer.url}</div>
                            <div class="influencer-url">プロフィール: ${influencer.profileUrl}</div>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="action-button edit-button" onclick="editInfluencer(${influencer.id})">編集</button>
                        <button class="action-button delete-button" onclick="deleteInfluencer(${influencer.id})">削除</button>
                    </div>
                </div>
            `).join('');
        }

        // モーダルの表示
        function showModal(title) {
            modalTitle.textContent = title;
            influencerModal.style.display = 'block';
        }

        // モーダルの非表示
        function hideModal() {
            influencerModal.style.display = 'none';
            influencerForm.reset();
        }

        // インフルエンサーの追加
        addInfluencerButton.addEventListener('click', () => {
            showModal('インフルエンサー追加');
        });

        // インフルエンサーの編集
        function editInfluencer(id) {
            const influencer = influencers.find(i => i.id === id);
            if (influencer) {
                document.getElementById('influencerName').value = influencer.name;
                document.getElementById('influencerDescription').value = influencer.description;
                document.getElementById('influencerPrice').value = influencer.price;
                document.getElementById('influencerFeatures').value = influencer.features.join(', ');
                document.getElementById('influencerUrl').value = influencer.url;
                document.getElementById('influencerProfileUrl').value = influencer.profileUrl;
                showModal('インフルエンサー編集');
            }
        }

        // インフルエンサーの削除
        function deleteInfluencer(id) {
            if (confirm('このインフルエンサーを削除してもよろしいですか？')) {
                influencers = influencers.filter(i => i.id !== id);
                renderInfluencerList();
                saveInfluencerData(); // データを保存
            }
        }

        // フォームの送信処理
        influencerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = {
                name: document.getElementById('influencerName').value,
                image: influencers.find(i => i.name === document.getElementById('influencerName').value)?.image || "Image/default.png",
                description: document.getElementById('influencerDescription').value,
                price: parseInt(document.getElementById('influencerPrice').value),
                features: document.getElementById('influencerFeatures').value.split(',').map(f => f.trim()),
                url: document.getElementById('influencerUrl').value,
                profileUrl: document.getElementById('influencerProfileUrl').value
            };

            if (modalTitle.textContent === 'インフルエンサー追加') {
                formData.id = influencers.length + 1;
                influencers.push(formData);
            } else {
                const index = influencers.findIndex(i => i.name === formData.name);
                if (index !== -1) {
                    influencers[index] = { ...influencers[index], ...formData };
                }
            }

            renderInfluencerList();
            hideModal();
            saveInfluencerData(); // データを保存
        });

        // キャンセルボタンの処理
        cancelButton.addEventListener('click', hideModal);

        // データのエクスポート機能を追加
        function exportData() {
            const dataStr = JSON.stringify(influencers, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'influencers.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        // データのインポート機能を追加
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    try {
                        const importedData = JSON.parse(event.target.result);
                        influencers = importedData;
                        renderInfluencerList();
                        saveInfluencerData();
                        alert('データをインポートしました');
                    } catch (error) {
                        alert('無効なデータファイルです');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        // 初期表示
        loadInfluencerData();
    </script>
</body>
</html> 